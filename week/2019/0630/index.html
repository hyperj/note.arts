



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="ARTS 打卡记录">
      
      
        <link rel="canonical" href="https://hyperj.net/note.arts/week/2019/0630/">
      
      
        <meta name="author" content="HyperJ">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="/assets/images/hyperj.ico">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.4.0">
    
    
      
        <title>ARTS - 2019 Week 6-5 - ARTS 打卡记录</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/application.0284f74d.css">
      
        <link rel="stylesheet" href="../../../assets/stylesheets/application-palette.01803549.css">
      
      
        
        
        <meta name="theme-color" content="">
      
    
    
      <script src="../../../assets/javascripts/modernizr.74668098.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../../assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="/assets/css/mkdocs/material.css">
    
    
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="white" data-md-color-accent="amber">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#arts-2019-week-6-5" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="https://hyperj.net/note.arts" title="ARTS 打卡记录" class="md-header-nav__button md-logo">
          
            <img src="/assets/images/hyperj.png" width="24" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              ARTS 打卡记录
            </span>
            <span class="md-header-nav__topic">
              
                ARTS - 2019 Week 6-5
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/hyperj/note.arts/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    hyperj/note.arts
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
        

<nav class="md-tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  <li class="md-tabs__item">
    
      <a href="../../.." title="首页" class="md-tabs__link md-tabs__link--active">
        首页
      </a>
    
  </li>

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../../share/2019/" title="Share" class="md-tabs__link">
          Share
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../" title="Week" class="md-tabs__link">
          Week
        </a>
      
    </li>
  

      
    </ul>
  </div>
</nav>
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="https://hyperj.net/note.arts" title="ARTS 打卡记录" class="md-nav__button md-logo">
      
        <img src="/assets/images/hyperj.png" width="48" height="48">
      
    </a>
    ARTS 打卡记录
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/hyperj/note.arts/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    hyperj/note.arts
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../../.." title="首页" class="md-nav__link">
      首页
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Share
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Share
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../share/2019/" title="2019" class="md-nav__link">
      2019
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Week
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Week
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../" title="2019" class="md-nav__link">
      2019
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#algorithm" title="Algorithm" class="md-nav__link">
    Algorithm
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#review" title="Review" class="md-nav__link">
    Review
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tunein-how-to-get-your-hadoopspark-jobs-tuned-while-youre-sleeping" title="TuneIn: How to Get Your Hadoop/Spark Jobs Tuned While You’re Sleeping" class="md-nav__link">
    TuneIn: How to Get Your Hadoop/Spark Jobs Tuned While You’re Sleeping
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_1" title="背景" class="md-nav__link">
    背景
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dr-elephant" title="Dr. Elephant" class="md-nav__link">
    Dr. Elephant
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tip" title="Tip" class="md-nav__link">
    Tip
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#kafka" title="Kafka 集群参数" class="md-nav__link">
    Kafka 集群参数
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#share" title="Share" class="md-nav__link">
    Share
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#spark" title="Spark 源码调试" class="md-nav__link">
    Spark 源码调试
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#reference" title="Reference" class="md-nav__link">
    Reference
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/hyperj/note.arts/blob/master/docs/week/2019/0630.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="arts-2019-week-6-5">ARTS - 2019 Week 6-5<a class="headerlink" href="#arts-2019-week-6-5" title="Permanent link">&para;</a></h1>
<p>20190630~20190706</p>
<h2 id="algorithm">Algorithm<a class="headerlink" href="#algorithm" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="https://leetcode.com/problems/remove-duplicates-from-sorted-array/">26. Remove Duplicates from Sorted Array</a></li>
<li><a href="https://leetcode.com/problems/remove-element/">27. Remove Element</a></li>
<li><a href="https://leetcode.com/problems/implement-strstr/">28. Implement strStr()</a></li>
<li><a href="https://leetcode.com/problems/search-insert-position/">35. Search Insert Position</a></li>
</ul>
<h2 id="review">Review<a class="headerlink" href="#review" title="Permanent link">&para;</a></h2>
<h3 id="tunein-how-to-get-your-hadoopspark-jobs-tuned-while-youre-sleeping"><a href="https://databricks.com/session/tunein-how-to-get-your-hadoop-spark-jobs-tuned-while-you-are-sleeping">TuneIn: How to Get Your Hadoop/Spark Jobs Tuned While You’re Sleeping</a><a class="headerlink" href="#tunein-how-to-get-your-hadoopspark-jobs-tuned-while-youre-sleeping" title="Permanent link">&para;</a></h3>
<p>Have you ever tuned a Spark, Hive or Pig job? If yes, then you must know that it is a never ending cycle of executing the job, observing the running job, making sense out of hundreds of metrics and then re-running it with the better parameters. Imagine doing this for tens of thousands of jobs. Performance optimization at this scale manually is tedious, requires significant expertise and results into wasting a lot of resources to do the same task again and again. </p>
<p>As Hadoop/Spark is the natural choice for any data processing with many naive users, it becomes important to develop a tool to automatically tune Hadoop/Spark jobs. At LinkedIn we tried to solve the problem using Dr. Elephant, an open-sourced self-serve performance monitoring and tuning tool for Hadoop and Spark, used at LinkedIn and various other companies. While it has proven to be very successful, it relies on the developers’ initiative to check and apply the recommendation manually. It also expects some expertise from developers to arrive at the optimal configuration from the recommendations. </p>
<p>In this talk we will discuss TuneIn, an auto tuning framework developed on top of Dr. Elephant. We will describe how we are using an iterative approach of optimization to find optimal parameters. We will discuss the various optimization algorithms we tried and why we found Particle Swarm Optimization algorithm to give best results. We will talk about how we avoided using any extra execution and tuned the jobs during their regular scheduled execution. We go into detail on techniques employed to ensure faster convergence and zero failed executions while tuning. We will showcase how we achieved more than 50% gain in resource usage by tuning a small set of parameters. We will also talk about the lessons learned and the future roadmap.</p>
<p><strong><a href="../../../asset/pdf/tunein-how-to-get-your-hadoop-spark-jobs-tuned-while-you-are-sleeping.pdf">【PDF】TuneIn: How to Get Your Hadoop/Spark Jobs Tuned While You’re Sleeping</a></strong></p>
<h3 id="_1">背景<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h3>
<ul>
<li>提升资源利用率</li>
<li>减少作业执行时间</li>
</ul>
<h3 id="dr-elephant">Dr. Elephant<a class="headerlink" href="#dr-elephant" title="Permanent link">&para;</a></h3>
<p><strong>Particle Swarm Optimization (PSO)</strong></p>
<ul>
<li>搜索空间：待调优的参数</li>
<li>优化：避免失败、加快收敛、约束优化、参数依赖</li>
<li>损失函数：预估资源的使用</li>
<li>惩罚函数：避免过拟合，导致资源分配过于苛刻</li>
</ul>
<p><strong>流程</strong></p>
<ol>
<li>作业调度系统获取作业执行参数</li>
<li>返回优化后的参数</li>
<li>作业调度系统提交作业</li>
<li>获取作业度量信息，分析作业</li>
</ol>
<p><strong>特征</strong></p>
<ul>
<li>对周期运行任务调优，可以自动关闭调优</li>
<li>控制资源使用和执行时间，支持hive、spark，易于集成</li>
<li>容错处理，参数调整约束，失败处理</li>
</ul>
<p><strong>规划</strong></p>
<ul>
<li>优化执行时长</li>
<li>通过IPSO提升收敛速度</li>
<li>更智能的优化开关</li>
</ul>
<h2 id="tip">Tip<a class="headerlink" href="#tip" title="Permanent link">&para;</a></h2>
<h3 id="kafka">Kafka 集群参数<a class="headerlink" href="#kafka" title="Permanent link">&para;</a></h3>
<p><strong>Broker</strong></p>
<ul>
<li>日志存放路径：<code>log.dirs=/data/kafka1,/data/kafka2</code></li>
<li>ZooKeeper 集群地址，协调、管理，保存 Kafka 集群元数据信息：<code>zookeeper.connect=zk1:2181,zk2:2181,zk3:2181/kafka1</code></li>
<li>监听器，访问 Kafka 服务的协议、主机名和端口：<code>listeners=PLAINTEXT://localhost:9092</code></li>
<li>不允许自动创建 Topic：<code>auto.create.topics.enable=false</code></li>
<li>不允许 Unclean Leader 选举：<code>unclean.leader.election.enable=false</code></li>
<li>不允许定期进行 Leader 选举：<code>auto.leader.rebalance.enable=false</code></li>
<li>消息保存的最长时间：<code>log.retention.hour{minutes|ms}=168</code></li>
<li>总体消息保存的最大容量：<code>log.retention.bytes=100 000 000 000</code></li>
<li>接收每条消息的最大大小：<code>message.max.bytes=1 000 000</code></li>
</ul>
<p><strong>Topic</strong></p>
<ul>
<li>消息保存的最长时间：<code>retention.ms=604 800 000</code></li>
<li>接收每条消息的最大大小：<code>max.message.bytes=1 000 000</code></li>
</ul>
<p><strong>JVM</strong></p>
<ul>
<li>堆内存设置：<code>export KAFKA_HEAP_OPTS=--Xms6g --Xmx6g</code></li>
<li>GC参数设置：<code>export KAFKA_JVM_PERFORMANCE_OPTS=-server -XX:+UseG1GC -XX:MaxGCPauseMillis=20 -XX:InitiatingHeapOccupancyPercent=35</code></li>
</ul>
<p><strong>OS</strong></p>
<ul>
<li>文件描述符限制：<code>ulimit -n 1000000</code></li>
<li>文件系统类型：<code>XFS、ZFS</code></li>
<li>调整 Swap 空间比例：<code>vm.swappiness=1</code></li>
<li>关闭访问时间</li>
</ul>
<h2 id="share">Share<a class="headerlink" href="#share" title="Permanent link">&para;</a></h2>
<h3 id="spark"><a href="../../../share/2019/spark-debug/">Spark 源码调试</a><a class="headerlink" href="#spark" title="Permanent link">&para;</a></h3>
<h2 id="reference">Reference<a class="headerlink" href="#reference" title="Permanent link">&para;</a></h2>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2013 - <span id="cyear">2013</span> HyperJ <script type="text/javascript">document.getElementById("cyear").innerText=new Date().getFullYear();document.write(unescape("%3Cdiv id='cnzz_stat_icon_1275779234'%3E%3C/div%3E%3Cscript src='https://s5.cnzz.com/z_stat.php%3Fid%3D1275779234%26online%3D1%26show%3Dline' type='text/javascript'%3E%3C/script%3E"));</script>
          </div>
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
  <div class="md-footer-social">
    <link rel="stylesheet" href="../../../assets/fonts/font-awesome.css">
    
      <a href="https://hyperj.net" class="md-footer-social__link fa fa-h-square"></a>
    
      <a href="https://github.com/hyperj" class="md-footer-social__link fa fa-github"></a>
    
      <a href="https://www.linkedin.com/in/hyperj" class="md-footer-social__link fa fa-linkedin"></a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../../assets/javascripts/application.245445c6.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"../../.."}})</script>
      
    
  </body>
</html>